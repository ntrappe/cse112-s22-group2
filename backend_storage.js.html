<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: backend/storage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: backend/storage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module Storage
 */

import { convertStorageDate } from '../components/control/control-helpers.js';

const EXIT_SUCCESS = 1;
const EXIT_FAILURE = 0;
const NOT_FOUND = -1;
const DECIMAL = 10;
const MIN_DATE = 1;
const MAX_DATE = 31;
const MIN_MONTH = 1;
const MAX_MONTH = 12;
const WEEKDAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July',
    'August', 'September', 'October', 'November', 'December'];

// let myObject = [];

/**
 * Function to determine if date is legitimate
 * @param {String} date; if received from addLog/updateLog then date
 * is from full daily log {weekday, month day, year}; otherwise,
 * date is from fetchLog/deleteLog from daily log preview {mm/dd/yyyy}
 * @param {Boolean} true if validating on a fetch or false
 * if validating on an add/update
 * @returns true or false depending on if true date
 */
function validateDate(date, fetch) {
    /**
     * Called from addLog/updateLog (daily log date)
     * Validating date of type {weekday, month day, year}
     */
    if (!fetch) {
        console.log(`validating [${date}]`);
        const dateSplitted = date.split(',');

        /* Input validation for day of the week */
        if (WEEKDAYS.indexOf((dateSplitted[0])) === NOT_FOUND) {
            console.warn(`Invalid Day of the Week passed: ${dateSplitted[0]}`);
            return EXIT_FAILURE;
        }

        // Input validation for month/day
        // Note that February 31 or April 30 is considered valid in this checker
        let monthAndDay = dateSplitted[1].substring(1);
        monthAndDay = monthAndDay.split(' ');

        if (MONTHS.indexOf(monthAndDay[0]) === NOT_FOUND) {
            console.warn(`Invalid month passed: ${monthAndDay[0]}`);
            return EXIT_FAILURE;
        }

        if (parseInt(monthAndDay[1], DECIMAL) &lt; MIN_DATE
        || MAX_DATE &lt; parseInt(monthAndDay[1], DECIMAL)) {
            console.warn(`Invalid day passed: ${monthAndDay[1]}`);
            return EXIT_FAILURE;
        }
    /**
     * Called from fetchLog/deleteLog (daily log preview date)
     * Validating date of type {mm/dd/yyyy}
     */
    } else {
        console.log(`validating [${date}]`);
        const dateSplitted = date.split('/');
        const month = dateSplitted[0];
        const day = dateSplitted[1];
        const year = dateSplitted[2];

        // check that month within reasonable range
        if (parseInt(month, DECIMAL) &lt; MIN_MONTH
        || parseInt(month, DECIMAL) > MAX_MONTH) {
            console.warn(`Invalid month passed: ${month}`);
            return EXIT_FAILURE;
        }

        // check that date within reasonable range
        if (parseInt(day, DECIMAL) &lt; MIN_DATE
        || parseInt(day, DECIMAL) > MAX_DATE) {
            console.warn(`Invalid day passed: ${day}`);
            return EXIT_FAILURE;
        }

        // Input validation for year
        // Note that it just checks whether the input is number
        if (Number.isNaN(parseInt(year, DECIMAL))) {
            console.warn(`Invalid year passed: ${year}`);
            return EXIT_FAILURE;
        }
    }

    return EXIT_SUCCESS;
}

/**
 * @method addLog
 * Method will ONLY be called from data in full daily log so date in
 * the form "{weekday}, {month} {day}, {year}", notes as a list of
 * strings where each string is text of &lt;li> and journal is a string
 * from content of that textarea
 * @param {String} date date text of log (DIFF THAN STORAGE KEY)
 * @param {String} tracker emoji for mood
 * @param {Object} notes list of strings
 * @param {String} journal text of journal
 * @returns whether operation was successful
 */
export function addLog(date, tracker, notes, journal) {
    if (validateDate(date, false) === EXIT_FAILURE) {
        return EXIT_FAILURE;
    }

    // Input validation for notes: check if contains only strings
    if (notes != null) {
        for (let i = 0; i &lt; notes.length; i++) {
            if (typeof (notes[i]) !== 'string') {
                console.warn('Notes must contain only strings.');
                return EXIT_FAILURE;
            }
        }
    }

    // Input validation for journal: check if a string
    if (typeof (journal) !== 'string') {
        console.warn('Journal must be string.');
        return EXIT_FAILURE;
    }

    if (localStorage.getItem(date) !== null) {
        console.warn('There already exists a log having the same date');
        return EXIT_FAILURE;
    }

    const logObj = {
        date: date,
        tracker: tracker,
        notes: notes,
        journal: journal,
    };

    localStorage.setItem(convertStorageDate(date), JSON.stringify(logObj));
    console.log('Successfully added to the local storage');
    return EXIT_SUCCESS;
}

/**
 * @method updateLog
 * Assumes that, given a date that a log exists at, the
 * user modified the ntoes or journal sections
 * NOTE: does NOT support if user updated the date of the
 * daily log (bc that functionality isn't done in daily log)
 * @param {String} date date text of log (DIFF THAN STORAGE KEY)
 * @param {String} tracker emoji for mood
 * @param {Object} notes list of strings
 * @param {String} journal text of journal
 * @returns whether operation was successful
 */
export function updateLog(date, tracker, notes, journal) {
    if (validateDate(date, false) === EXIT_FAILURE) {
        return EXIT_FAILURE;
    }

    // Input validation for notes: check if contains strings
    if (notes != null) {
        for (let i = 0; i &lt; notes.length; i++) {
            if (typeof (notes[i]) !== 'string') {
                console.log('Notes must contain only strings.');
                return EXIT_FAILURE;
            }
        }
    }

    // Input validation for journal: check if string
    if (typeof (journal) !== 'string') {
        console.log('Journal must be string.');
        return EXIT_FAILURE;
    }

    const storageDate = convertStorageDate(date);
    if (localStorage.getItem(storageDate) === null) {
        console.log(`There is no log having the date: ${date}`);
        return EXIT_FAILURE;
    }

    const previousLog = JSON.parse(localStorage.getItem(storageDate));
    const previousDate = previousLog.date;

    const logObj = {
        date: previousDate,
        tracker: tracker,
        notes: notes,
        journal: journal,
    };

    localStorage.setItem(storageDate, JSON.stringify(logObj));
    return EXIT_SUCCESS;
}

/**
 * Retrieves value stored at key that corresponds to date param
 * then parses and returns it
 * @param {String} date of preview
 * @returns JS object with date, notes, journal
 */
export function fetchLog(date) {
    if (validateDate(date, true) === EXIT_FAILURE) {
        return EXIT_FAILURE;
    }

    const searchResult = localStorage.getItem(convertStorageDate(date));
    if (searchResult === null) {
        console.warn(`No log found with the date: ${date}`);
        return EXIT_FAILURE;
    }

    console.log('Log successfully found.');
    return JSON.parse(searchResult);
}

/**
 * Iterates through all values in local storage, parses,
 * adds to list, and returns
 * @returns list of JS objects with date, notes, journal
 */
export function fetchAll() {
    const searchResult = [];
    for (let i = 0; i &lt; localStorage.length; i++) {
        // console.log(`Log at ${localStorage.key(i)}: ${localStorage.getItem(localStorage.key(i))}`);
        const storedLog = localStorage.getItem(localStorage.key(i));
        searchResult.push(JSON.parse(storedLog));
    }
    return searchResult;
}

/**
 * Removes item stored at key that corresponds to date param
 * @param {String} date of preview
 * @returns if operation was successful
 */
export function deleteLog(date) {
    if (validateDate(date, true) === EXIT_FAILURE) {
        return EXIT_FAILURE;
    }

    const storageDate = convertStorageDate(date);
    const searchResult = localStorage.getItem(storageDate);
    if (searchResult === null) {
        console.warn(`No log found with the date: ${date}`);
        return EXIT_FAILURE;
    }
    localStorage.removeItem(storageDate);

    return EXIT_SUCCESS;
}

export function deleteAll() {
    localStorage.clear();
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="DailyLogPreview%250AClass%2520that%2520renders%2520a%2520brief%2520preview%2520of%2520a%2520daily%2520logmodule_.html">DailyLogPreview
Class that renders a brief preview of a daily log</a></li><li><a href="DailyLogPreview%250AClass%2520that%2520renders%2520a%2520full%2520daily%2520logmodule_.html">DailyLogPreview
Class that renders a full daily log</a></li><li><a href="module-add-component.html">add-component</a></li><li><a href="module-inboxHelper.html">inboxHelper</a></li><li><a href="module-Storage.html">Storage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#changeBulletChangesthebullettypetoselectedbulletandautoclosesmodal">changeBullet
Changes the bullet type to selected bullet and auto closes modal</a></li><li><a href="global.html#convertStorageDate">convertStorageDate</a></li><li><a href="global.html#createListElementCreatesanewnoteentryelementandappendsittotheNotessection">createListElement
Creates a new note entry element and appends it to the Notes section</a></li><li><a href="global.html#currentEntries">currentEntries</a></li><li><a href="global.html#deleteEntryDeletesabulletiftheuserpressesbackspaceonanemptybulletanddeletesentryfromcurrentEntries.Helperfunctionforcontrol.">deleteEntry
Deletes a bullet if the user presses backspace on an empty bullet
and deletes entry from currentEntries.
Helper function for control.</a></li><li><a href="global.html#deleteEntryUpdatesvalueofentryincurrentEntries.">deleteEntry
Updates value of entry in currentEntries.</a></li><li><a href="global.html#enterKeyPressedCreatesanewbulletonthenextlineiftheuserpressesenterandaddscurrententrytocurrentEntries,orifanexistingbulletiseditedthenitupdatestheentryincurrentEntriesHelperfunctionforcontrol.">enterKeyPressed
Creates a new bullet on the next line if the user presses enter and adds
current entry to currentEntries, or if an existing bullet is edited then
it updates the entry in currentEntries
Helper function for control.</a></li><li><a href="global.html#launchBulletModalUpdatesmostrecentbulletwiththebulletthattriggeredthiseventhandlerandlaunchesbulletmodalwithadisplayofthisselectedlistelement">launchBulletModal
Updates most recent bullet with the bullet that triggered this event handler
and launches bullet modal with a display of this selected list element</a></li><li><a href="global.html#notesClickHidesthenotesplaceholderandcreatesanewbullet.">notesClick
Hides the notes placeholder and creates a new bullet.</a></li><li><a href="global.html#populateListElementYesthisisaveryredundantfunction.(TODO:relyonabovefxn).Willrepopulatethelistofbulletpointsfromlocalstoragebycreatingabulletpoint,addingcontent,andsettingbulletstyle.">populateListElement
Yes this is a very redundant function. (TODO: rely on above fxn).
Will repopulate the list of bullet points from local storage
by creating a bullet point, adding content, and setting bullet style.</a></li><li><a href="global.html#setDefaultDateHelperfunctiontofetchcurrentdateandformattobe%2522%257Bdayofweek%257D,%257Bmonth%257D%257Bdate%257D,%257Byear%257D%2522">setDefaultDate
Helper function to fetch current date and format
to be "{day of week}, {month} {date}, {year}"</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Jun 09 2022 23:04:59 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
